{{> layout/header}}

<!-- ë©”ì¸í˜ì´ì§€(ì¸ë±ìŠ¤) í™”ë©´-->
<!-- 1, 6, 7, 8, 9 í™”ë©´ ì—°ê´€-->
<!-- TODO ë¡œê·¸ì¸ì „, í›„ NavBar ì„¤ì • í•„ìš”  -->
<div class="d-flex justify-content-center align-items-center">
	
	<div class="col-auto"></div>
	
	<div class="col-xxl-7 col-xl-9 col-lg-10 col-md-11 col-sm-12">


		<form action="/" method="get" id="selectform"> <!-- form="selectform"ë‘ id ê°™ê²Œ í•´ì•¼ ë°›ì•„ì˜´  -->
		<div class="d-flex justify-content-around ps-4 pe-4">



			<div class="order-2 m-2 border border-info col-4">
				<h4 class="mt-2 text-center">ê¸°ìˆ ë³„</h4>

				<div class="d-flex justify-content-between">
					<div class="form-check d-inline-block ms-3 me-2 align-self-end">
						<label class="form-check-label">
							<input class="form-check-input" type="checkbox" name="skillList" id="all" value="all" onclick="skillCheck(this)">
						ëª¨ë‘</label>
					</div>
					<div class="btn btn-primary me-3 m-1 btn-sm" onclick="searchOnlySkill()">ê¸°ìˆ ë§Œ ê²€ìƒ‰</div>
				</div>

				<hr class="m-1">
				<div class="d-flex flex-wrap">
					
					{{#skillList}}
					<div class="form-check d-inline-block ms-3 me-2">
						<label class="form-check-label">
							<input class="skillFind form-check-input" type="checkbox" name="skillList" value="{{skillname}}" id="{{skillname}}" onclick='skillAllCheck()'>
						{{skillname}}</label>
					</div>
					{{/skillList}}
					
				</div>
			</div>



			<div class="order-1 m-2 border border-info col-4">
				<h4 class="mt-2 text-center">ì§€ì—­ë³„</h4>
				
				<div class="d-flex justify-content-between">
					<div class="form-check d-inline-block ms-3 me-2 align-self-end">
						<label class="form-check-label">
							<input class="form-check-input all3checkbox" type="checkbox" name="" id="" value="" onclick="regionCheck(this)">
						ëª¨ë‘</label>
					</div>
					<div class="btn btn-primary me-3 m-1 btn-sm" onclick="searchOnlyRegion()">ì§€ì—­ë§Œ ê²€ìƒ‰</div>
				</div>

				<hr class="m-1">
				
				<div class="d-flex justify-content-around p-1">
						
					<div class="d-flex justify-content-center">

						<select class="me-2" name="region" form="selectform" onchange="regionCheck2(this)">
							<option class="all3" id="all3" value="all">ì„ íƒí•˜ì„¸ìš”.</option> 
							<option id="ì„œìš¸" value="ì„œìš¸">ì„œìš¸/ì¸ì²œ/ê²½ê¸°</option> 
							<option id="ë¶€ì‚°" value="ë¶€ì‚°">ë¶€ì‚°/ìš¸ì‚°/ê²½ë‚¨</option> 
							<option id="ëŒ€êµ¬" value="ëŒ€êµ¬">ëŒ€êµ¬/ê²½ë¶</option> 
							<option id="ê´‘ì£¼" value="ê´‘ì£¼">ê´‘ì£¼/ì „ë¼</option> 
							<option id="ëŒ€ì „" value="ëŒ€ì „">ëŒ€ì „/ì„¸ì¢…/ì¶©ì²­</option> 
							<option id="ê°•ì›" value="ê°•ì›">ê°•ì›</option> 
							<option id="ì œì£¼" value="ì œì£¼">ì œì£¼</option> 
						</select>
	
						<select class=""> 
							<option id="" value="">ì„ íƒí•˜ì„¸ìš”.</option> 
							<option value="ê°•ì„œêµ¬">ê°•ì„œêµ¬</option> 
							<option value="ê¸ˆì •êµ¬">ê¸ˆì •êµ¬</option> 
							<option value="ë‚¨êµ¬">ë‚¨êµ¬</option> 
							<option value="ë™êµ¬">ë™êµ¬</option> 
							<option value="ë™ë˜êµ¬">ë™ë˜êµ¬</option> 
						</select>
	
					</div>
				</div>

			</div>




			<div class="order-3 m-2 border border-info col-4">
				<h4 class="mt-2 text-center">ì§ë¬´ë³„</h4>

				<div class="d-flex justify-content-between">
					<div class="form-check d-inline-block ms-3 me-2 align-self-end">
						<label class="form-check-label">
							<input class="form-check-input" type="radio" id="all2" name="position" value="all">
						ëª¨ë‘</label>
					</div>
					<div class="btn btn-primary me-3 m-1 btn-sm" onclick="searchOnlyPosition()">ì§ë¬´ë§Œ ê²€ìƒ‰</div>
				</div>

				<hr class="m-1">

				<div class="d-flex flex-wrap">

					<div class="form-check d-inline-block ms-3 me-2">
						<label class="form-check-label">
							<input class="form-check-input" type="radio" id="ë°±ì—”ë“œ" name="position" value="ë°±ì—”ë“œ">
						ë°±ì—”ë“œ</label>
					</div>
					<div class="form-check d-inline-block ms-3 me-2">
						<label class="form-check-label">
							<input class="form-check-input" type="radio" id="í”„ë¡ íŠ¸ì—”ë“œ" name="position" value="í”„ë¡ íŠ¸ì—”ë“œ">
						í”„ë¡ íŠ¸ì—”ë“œ</label>
					</div>
					<div class="form-check d-inline-block ms-3 me-2">
						<label class="form-check-label">
							<input class="form-check-input" type="radio" id="í’€ìŠ¤íƒ" name="position" value="í’€ìŠ¤íƒ">
						í’€ìŠ¤íƒ</label>
					</div>
					<div class="form-check d-inline-block ms-3 me-2">
						<label class="form-check-label">
							<input class="form-check-input" type="radio" id="ì•ˆë“œë¡œì´ë“œ" name="position" value="ì•ˆë“œë¡œì´ë“œ">
						ì•ˆë“œë¡œì´ë“œ</label>
					</div>
					<div class="form-check d-inline-block ms-3 me-2">
						<label class="form-check-label">
							<input class="form-check-input" type="radio" id="IOS" name="position" value="IOS">
						IOS</label>
					</div>
					<div class="form-check d-inline-block ms-3 me-2">
						<label class="form-check-label">
							<input class="form-check-input" type="radio" id="ì„ë² ë””ë“œ" name="position" value="ì„ë² ë””ë“œ">
						ì„ë² ë””ë“œ</label>
					</div>
					<div class="form-check d-inline-block ms-3 me-2">
						<label class="form-check-label">
							<input class="form-check-input" type="radio" id="ë¹…ë°ì´í„°" name="position" value="ë¹…ë°ì´í„°">
						ë¹…ë°ì´í„°</label>
					</div>
					<div class="form-check d-inline-block ms-3 me-2">
						<label class="form-check-label">
							<input class="form-check-input" type="radio" id="ì„œë²„" name="position" value="ì„œë²„">
						ì„œë²„</label>
					</div>
					<div class="form-check d-inline-block ms-3 me-2">
						<label class="form-check-label">
							<input class="form-check-input" type="radio" id="ë¨¸ì‹ ëŸ¬ë‹" name="position" value="ë¨¸ì‹ ëŸ¬ë‹">
						ë¨¸ì‹ ëŸ¬ë‹</label>
					</div>

				</div>


			</div>

			
		</div>
		<div class="m-2">
			<div class="btn btn-success w-100" onclick="searchAll()">ê²€ìƒ‰í•˜ê¸°</div>
		</div>
	</form>





		<div class="mb-4 d-flex flex-wrap">


			{{#postingList}}
			<div class="col-lg-3 col-md-4 col-sm-6">
				<div class="border border-info m-2 ps-2 pe-2 pt-1">
					<h4 class="text-center fw-bold">{{user.compname}}</h4>
					{{#user.photo}}<a href="/comp/posting/{{id}}" class="text-black text-decoration-none"><img src="../../../images/{{user.photo}}" class="img-fluid d-block m-auto" style="height: 120px;">{{/user.photo}}
					{{^user.photo}}<a href="/comp/posting/{{id}}" class="text-black text-decoration-none"><img src="../../../images/no_logo.png" class="img-fluid d-block m-auto" style="height: 120px;">{{/user.photo}}
						<h5 class="mt-1 fw-bold">{{title}}</h5>
						<div class="mb-1 fst-italic">{{position}}</div>
						<div class="mb-1">
							{{#postingSkill}}<span class="badge bg-primary me-1">{{skill.skillname}}</span>{{/postingSkill}}
						</div>
						<div>
							{{#career}}<span class="badge bg-success">{{career}}</span>{{/career}}
							{{#education}}<span class="badge bg-success">{{education}}</span>{{/education}}
							<span class="badge bg-success">{{region}}</span>
						</div>
					</a>
					<div class="d-flex justify-content-between">
						<button type="button" class="border-0 bg-white mt-1 like-button" id="posting{{id}}" onclick="bookmarkChange(`{{id}}`)"><h3>ğŸ¤</h3></button>
						<!-- <button type="button" class="border-0 bg-white mt-2"><h3>â¤ï¸</h3></button> -->
						<span class="expiryDate fw-bold align-self-center me-2">{{#expiryDate}}{{expiryDate}}{{/expiryDate}}</span>
					</div>
				</div>
			</div>
			{{/postingList}}



			
		</div>
	</div>

	<div class="col-auto"></div>
</div>




<input type="hidden" value="{{json}}" name="json" id="json">
<input type="hidden" value="{{position}}" name="positionSet" id="positionSet">
<input type="hidden" value="{{region}}" name="regionSet" id="regionSet">

<script>





	function Ddaycheck(day){
		if(typeof day === "string"){
			let day2 = new Date(day);
			return Ddaycheck(day2);
		} else{
			let today = new Date();

			// console.log((day-today) / (1000 * 60 * 60 * 24));
			let DDay = Math.ceil( (day-today) / (1000 * 60 * 60 * 24));

			if(DDay==0){
				// console.log("D-Day");
				return "D-Day";
			}
			else if(DDay<0){
				// console.log("ë§Œë£Œ");
				return "ë§Œë£Œ";
			}
			else{
				// console.log("D-"+DDay); 
				return "D-"+DDay;
			}
		}
	}
	let day = document.querySelectorAll('.expiryDate');
	day.forEach(element => {
		element.textContent = Ddaycheck(element.textContent);
	});
	// ë‚ ì§œ D-Dayë¡œ ë°”ê¾¸ê¸°


	
	function skillCheck(selectAll){
		let skillAll=document.querySelectorAll(".skillFind");
		// let allCheck=document.querySelector("#all");

		skillAll.forEach(element => {
			element.checked=selectAll.checked;
		});
	}
	function skillAllCheck(){
		let allCheck=document.querySelector("#all");
		let skillAll=document.querySelectorAll(".skillFind");
		let skillAllCheck=document.querySelectorAll(".skillFind:checked");

		if(skillAll.length==skillAllCheck.length){
			allCheck.checked=true;
		}else{
			allCheck.checked=false
		};
	}
	// ê¸°ìˆ  ëª¨ë‘ ì²´í¬ë°•ìŠ¤ ì‘ë™í•˜ê²Œ

//////////
	function check(){
		const json = JSON.parse(document.querySelector("#json").value);

		let skillCheckBoxAll = document.getElementById("all");

		if(json[0]!=skillCheckBoxAll.value){
			json.forEach(element => {
				document.getElementById(element).checked=true;
			});
			skillCheckBoxAll.checked=false;
		} else{
			skillCheckBoxAll.checked=true;
			let skillFind2 = document.querySelectorAll(".skillFind")
			skillFind2.forEach(element => {
				element.checked=true;
			});
		}
	}
	check();

	const positionSet = document.querySelector("#positionSet").value;
	if(positionSet=="all"){
		document.getElementById("all2").checked=true;
	} else{
		document.getElementById(positionSet).checked=true;
	}

	const regionSet = document.querySelector("#regionSet").value;
	if(regionSet=="all"){
		document.querySelector(".all3checkbox").checked=true;
	} else{
		document.getElementById(regionSet).selected=true;
	}
////////// í˜„ì¬ ê²€ìƒ‰ì¤‘ì¸ê±° ë·° ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ë„ ì½ì–´ì˜¤ê²Œ
	
	function regionCheck(checkbox){
		if(checkbox.checked){
			document.getElementById("all3").selected=true;
		}
	}
	function regionCheck2(checkbox){
		let select = checkbox.value;
		if(select=="all"){
			document.querySelector(".all3checkbox").checked=true;
		} else{
			document.querySelector(".all3checkbox").checked=false;
		}
	}
	// ì§€ì—­ë³„ ì„ íƒë°”-ëª¨ë‘ì²´í¬ë°•ìŠ¤ ì—°ë™
	

	function searchOnlyPosition(){
		document.querySelector(".all3checkbox").checked=true;
		document.getElementById("all3").selected=true;
		
		let skillfind = document.querySelectorAll(".skillFind")
		skillfind.forEach(element => {
			element.checked=false;
		});
		document.querySelector("#all").checked=true;

		let submit = document.getElementById("selectform");
		submit.submit();
	}

	function searchOnlyRegion(){
		document.getElementById("all2").checked=true;

		let skillfind = document.querySelectorAll(".skillFind")
		skillfind.forEach(element => {
			element.checked=false;
		});
		document.querySelector("#all").checked=true;

		let submit = document.getElementById("selectform");
		submit.submit();
	}

	function searchOnlySkill(){
		document.querySelector(".all3checkbox").checked=true;
		document.getElementById("all3").selected=true;

		document.getElementById("all2").checked=true;

		let submit = document.getElementById("selectform");
		submit.submit();
	}

	function searchAll(){
		if(document.querySelector("#all").checked){
			let skillfind = document.querySelectorAll(".skillFind")
			skillfind.forEach(element => {
				element.checked=false;
			});
		}
		let submit = document.getElementById("selectform");
		submit.submit();
	}

	let bookmarked = '<h3>â¤ï¸</h3>';
	let noBookmark = '<h3>ğŸ¤</h3>';

	async function bookmarkPoint() {
// console.log('bookmarkPointì‹¤í–‰')
		// let response = await fetch(`/check?username=${username}`);
		let postingNum = document.querySelectorAll(".posting");
// 		console.log(postingNum);

        let response = await fetch("/api/user/bookmark");
		// let bookmarkPoint = document.querySelector("#username").value;
		let body = await response.json();

		let dataArray = body.data;
		for(let item of dataArray){

			let postingNum = document.querySelector(`#posting${item.id}`);
			let currentValue = postingNum.getAttribute('data-value');
			currentValue = true;
			postingNum.innerHTML = bookmarked;
			postingNum.setAttribute('data-value', currentValue);
		}
	}
	// let response = await fetch("/api/tech?categoryId=" + categoryId);
		bookmarkPoint();



	async function bookmarkChange(id){

		let postingNum = document.querySelector(`#posting${id}`);
		let currentValue = postingNum.getAttribute('data-value');
		

		if( currentValue == 'true'){

			console.log(id);
			let response = await fetch(`/api/user/bookmark/${id}/delete`);
			let body = await response.json();
			
			if(body.sucuess == false){
				alert(body.data)}
			if(body.sucuess == true){
				alert(body.data)
			currentValue = false;
			postingNum.innerHTML = noBookmark;
			}


		}
		else{
			console.log(id);
			let response = await fetch(`/api/user/bookmark/${id}/save`);
			let body = await response.json();

			if(body.sucuess == false){
				alert(body.data)}
			if(body.sucuess == true){
				alert(body.data)
			currentValue = true;
			postingNum.innerHTML = bookmarked;
			}

		}


		postingNum.setAttribute('data-value', currentValue);

	}
</script>




{{> layout/footer}}