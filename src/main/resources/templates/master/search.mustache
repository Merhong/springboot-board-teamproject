{{> layout/header}}
<div class="d-flex justify-content-center align-items-center">

	<div class="col-auto"></div>

	<div class="col-xxl-7 col-xl-9 col-lg-10 col-md-11 col-sm-12">


		<div class="text-center mt-1"><h3>í†µí•©ê²€ìƒ‰</h3></div>
		<div class="text-center mb-3">ê²€ìƒ‰ì–´ê°€ <b>íšŒì‚¬ëª…</b>, <b>ê³µê³ ëª…</b>, <b>ì´ë ¥ì„œëª…</b>, <b>ìœ ì €ì‹¤ëª…</b>ì— í¬í•¨ë˜ë©´ ê²€ìƒ‰ë©ë‹ˆë‹¤.</div>


		{{#totalCount}}
			<div class="text-center">ê²°ê³¼ : ì´í•© <b>{{totalCount}}</b>ê°œ, <b>{{totalPage}}</b>í˜ì´ì§€</div>

			<ul class="pagination d-flex justify-content-center mt-1">
				<li class="page-item {{#first}}disabled{{/first}}">
					<button class="page-link" onclick="searchAllPageMinus()">ì´ì „ í˜ì´ì§€</button>
				</li>
				<li class="page-item">
					<div class="page-link">{{#pageSearchAll}}{{pageSearchAll}}{{/pageSearchAll}}{{^pageSearchAll}}
						0{{/pageSearchAll}}</div>
				</li>
				<li class="page-item {{#last}}disabled{{/last}}">
					<button class="page-link" onclick="searchAllPagePlus()">ë‹¤ìŒ í˜ì´ì§€</button>
				</li>
			</ul>
		{{/totalCount}}



		{{#searchDTO}}



			<div class="mb-4 d-flex flex-wrap">


				{{#compUserList}}
					<div class="col-lg-3 col-md-4 col-sm-6 mb-4">
						<div class="m-2 mb-0 ps-2 pe-2 pt-1 bg-warning-subtle">
							<h4 class="text-center fw-bold">{{compname}}</h4>
							{{#photo}}
							<a href="/comp/company/{{id}}" class="text-black text-decoration-none"><img
								src="/images/{{photo}}" class="img-fluid d-block m-auto"
								style="height: 120px;">{{/photo}}
							{{^photo}}
							<a href="/comp/company/{{id}}" class="text-black text-decoration-none"><img
								src="/images/no_logo.png" class="img-fluid d-block m-auto"
								style="height: 120px;">
							{{/photo}}

							<div class="d-flex align-items-center mt-3">
								<span>ì „í™”ë²ˆí˜¸ : </span>
								<span class="ms-1 fw-bold mt-2 mb-1"> {{tel}}</span>
							</div>

							<div class="d-flex align-items-center">
								<span>ì´ë©”ì¼ : </span>
								<span class="ms-1 fw-bold mt-2 mb-1">{{email}}</span>
							</div>

							<div class="d-flex align-items-center">
								<span>í™ˆí˜ì´ì§€ : </span>
								<span class="ms-1 fw-bold mt-2 mb-1">{{homepage}}</span>
							</div>

							<div class="d-flex align-items-center mb-2">
								<span>ì£¼ì†Œ : </span>
								<span class="ms-1 fw-bold mt-2 mb-1">{{address}}</span>
							</div>

						</a>

						</a>
							<div class="d-flex justify-content-between">

							</div>
						</div>
						<div class="text-center">ê¸°ì—…</div>
					</div>
				{{/compUserList}}





				{{#postingList}}
					<div class="col-lg-3 col-md-4 col-sm-6 mb-4">
						<div class="m-2 mb-0 ps-2 pe-2 pt-1" style="background-color: #66e3dd;">
							<h4 class="text-center fw-bold mt-1">{{user.compname}}</h4>
							{{#user.photo}}<a href="/comp/posting/{{id}}" class="text-black text-decoration-none"><img
								src="/images/{{user.photo}}" class="img-fluid d-block m-auto"
								style="height: 120px;">{{/user.photo}}
							{{^user.photo}}<a href="/comp/posting/{{id}}" class="text-black text-decoration-none"><img
								src="/images/no_logo.png" class="img-fluid d-block m-auto"
								style="height: 120px;">{{/user.photo}}
							<h5 class="mt-1 fw-bold">{{title}}</h5>
							<div class="mb-1 fst-italic">{{position}}</div>
							<div class="mb-1">
								{{#postingSkill}}<span
									class="badge bg-primary me-1">{{skill.skillname}}</span>{{/postingSkill}}
							</div>
							<div>
								{{#career}}<span class="badge bg-success">{{career}}</span>{{/career}}
								{{#education}}<span class="badge bg-success">{{education}}</span>{{/education}}
								<span class="badge bg-success">{{region}}</span>
							</div>
						</a>

						</a>
							<div class="d-flex justify-content-between">
								{{^sessionComp.compname}}
									<button type="button" class="border-0 mt-1 like-button" id="posting{{id}}"
									        style="background-color: #66e3dd;"
									        onclick="bookmarkChange(`{{id}}`)"><h3>ğŸ¤</h3>
									</button>{{/sessionComp.compname}}
								<!-- <button type="button" class="border-0 bg-white mt-2"><h3>â¤ï¸</h3></button> -->
								<!-- ê¸°ì—… ìœ ì €ëŠ” ë¶ë§ˆí¬ ëª»í•˜ê²Œ -->
								{{#sessionComp.compname}}
									<button type="button" class="invisible"><h3>ğŸ¤</h3></button>{{/sessionComp.compname}}

								<span
									class="expiryDate fw-bold align-self-center me-2">{{#expiryDate}}{{expiryDate}}{{/expiryDate}}</span>
							</div>
						</div>
						<div class="text-center">êµ¬ì¸ê³µê³ </div>
					</div>
				{{/postingList}}





				{{#resumeList}}
					<div class="col-lg-3 col-md-4 col-sm-6 mb-4">
						<div class="m-2 mb-0 ps-2 pe-2 pt-1" style="background-color: pink;">
							</span><h4 class="text-center fw-bold mt-1">{{user.username}}</h4>
							{{#user.photo}}
							<a href="/resume/{{id}}" class="text-black text-decoration-none"><img
								src="/images/{{user.photo}}" class="img-fluid d-block m-auto"
								style="height: 120px;">{{/user.photo}}
							{{^user.photo}}
							<a href="/resume/{{id}}" class="text-black text-decoration-none"><img
								src="/images/no_logo.png" class="img-fluid d-block m-auto"
								style="height: 120px;">
							{{/user.photo}}
							<h5 class="mt-1 fw-bold">{{title}}</h5>
							<span class="badge bg-warning mt-1 mb-1">{{#user.birth}}{{user.birth}}{{/user.birth}}</span>
							<div class="mb-1">
								{{#user.userSkillList}}<span
									class="badge bg-primary me-1">{{skill.skillname}}</span>{{/user.userSkillList}}
							</div>
							<div>
								{{#career}}<span class="badge bg-success">{{career}}</span>{{/career}}
								{{#grade}}<span class="badge bg-success">{{grade}}</span>{{/grade}}
								<span class="badge bg-success">{{#user.address}}{{user.address}}{{/user.address}}</span>
							</div>
						</a>

						</a>
							<div class="d-flex justify-content-between">

								<div class="mt-2 fst-italic">{{user.position}}</div>
								<button type="button" class="invisible"><h3>ğŸ¤</h3></button>
							</div>
						</div>
						<div class="text-center">ê°œì¸ì´ë ¥ì„œ</div>
					</div>
				{{/resumeList}}


			</div>



		{{/searchDTO}}




		{{^searchDTO}}
			<h1 class="text-center">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ.</h1>
		{{/searchDTO}}

	</div>
</div>

<div class="col-auto"></div>
</div>


<script>

	function Ddaycheck(day) {
		if (typeof day === "string") {
			let day2 = new Date(day);
			return Ddaycheck(day2);
		} else {
			let today = new Date();

			// console.log((day-today) / (1000 * 60 * 60 * 24));
			let DDay = Math.ceil((day - today) / (1000 * 60 * 60 * 24));

			if (DDay == 0) {
				// console.log("D-Day");
				return "D-Day";
			} else if (DDay < 0) {
				// console.log("ë§Œë£Œ");
				return "ë§Œë£Œ";
			} else {
				// console.log("D-"+DDay); 
				return "D-" + DDay;
			}
		}
	}

	let day = document.querySelectorAll('.expiryDate');
	day.forEach(element => {
		element.textContent = Ddaycheck(element.textContent);
	});


	document.addEventListener("DOMContentLoaded", function () {
		const likeButtons = document.querySelectorAll(".like-button");

		// ê°ê°ì˜ ì¢‹ì•„ìš” ë²„íŠ¼ì— í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
		likeButtons.forEach(button => {
			button.addEventListener("click", function () {
				// ë²„íŠ¼ì˜ í´ë˜ìŠ¤ë¥¼ í† ê¸€ (liked í´ë˜ìŠ¤ ì¶”ê°€/ì œê±°)
				button.classList.toggle("liked");

				// ë²„íŠ¼ì˜ í•˜íŠ¸ ì•„ì´ì½˜ ë³€ê²½
				const heartIcon = button.querySelector("h3");
				if (button.classList.contains("liked")) {
					heartIcon.textContent = "â¤ï¸";
				} else {
					heartIcon.textContent = "ğŸ¤";
				}
			});
		});
	});

	function toggleLike(postId) {
		// ì´ ë¶€ë¶„ì—ì„œ ì„œë²„ë¡œ ë¶ë§ˆí¬ ì¶”ê°€ ë˜ëŠ” ì œê±° ìš”ì²­ì„ ë³´ë‚´ê³ ,
		// ì„œë²„ì—ì„œ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ë©´ success ë˜ëŠ” error ì½œë°±ì„ ì²˜ë¦¬í•˜ì—¬
		// í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ í•˜íŠ¸ ëª¨ì–‘ì„ ë³€ê²½í•©ë‹ˆë‹¤.

		// AJAX ë˜ëŠ” Fetch APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì™€ í†µì‹ í•˜ì—¬ ë¶ë§ˆí¬ë¥¼ ì¶”ê°€ ë˜ëŠ” ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
		// ì´ ì˜ˆì‹œì—ì„œëŠ” ì„œë²„ ìš”ì²­ì´ ì„±ê³µí•˜ë©´ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ í•˜íŠ¸ ëª¨ì–‘ì„ ë³€ê²½í•˜ë„ë¡ ê°€ì •í•©ë‹ˆë‹¤.

		// postIdë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ ìš”ì²­ì„ êµ¬ì„±í•˜ê³ , ë¶ë§ˆí¬ ì¶”ê°€ ë˜ëŠ” ì œê±° ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
		// ì„±ê³µì ì¸ ì‘ë‹µì„ ë°›ìœ¼ë©´ í•´ë‹¹ ê³µê³ ì˜ í•˜íŠ¸ ëª¨ì–‘ì„ ë³€ê²½í•©ë‹ˆë‹¤.

		const likeButton = document.querySelector(`[data-postid="${postId}"]`);

		// ì´ ë¶€ë¶„ì—ì„œ ì„œë²„ ìš”ì²­ì„ ë³´ë‚´ê³ , ì„±ê³µ ë˜ëŠ” ì‹¤íŒ¨ ì‹œ ì ì ˆí•œ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
		// ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚´ê³  ì‘ë‹µì„ ë°›ëŠ” ë°©ë²•ì€ AJAX ë˜ëŠ” Fetch APIë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

		// ì•„ë˜ ì˜ˆì‹œì—ì„œëŠ” ë‹¨ìˆœíˆ í•˜íŠ¸ ëª¨ì–‘ì„ í† ê¸€(toggle)í•©ë‹ˆë‹¤.
		if (likeButton.classList.contains("liked")) {
			likeButton.classList.remove("liked");
		} else {
			likeButton.classList.add("liked");
		}
	}


	let bookmarked = '<h3>â¤ï¸</h3>';
	let noBookmark = '<h3>ğŸ¤</h3>';

	async function bookmarkPoint() {
// console.log('bookmarkPointì‹¤í–‰')
		// let response = await fetch(`/check?username=${username}`);
		let postingNum = document.querySelectorAll(".posting");
// 		console.log(postingNum);

		let response = await fetch("/api/user/bookmark");
		// let bookmarkPoint = document.querySelector("#username").value;
		let body = await response.json();

		let dataArray = body.data;
		if (dataArray != null) {
			for (let item of dataArray) {

				let postingNum = document.querySelector(`#posting${item.id}`);
				let currentValue = postingNum.getAttribute('data-value');
				currentValue = true;
				postingNum.innerHTML = bookmarked;
				postingNum.setAttribute('data-value', currentValue);
			}
		}
	}

	// let response = await fetch("/api/tech?categoryId=" + categoryId);
	bookmarkPoint();


	async function bookmarkChange(id) {

		let postingNum = document.querySelector(`#posting${id}`);
		let currentValue = postingNum.getAttribute('data-value');


		if (currentValue == 'true') {

			console.log(id);
			let response = await fetch(`/api/user/bookmark/${id}/delete`);
			let body = await response.json();

			if (body.sucuess == false) {
				alert(body.data)
			}
			if (body.sucuess == true) {
				alert(body.data)
				currentValue = false;
				postingNum.innerHTML = noBookmark;
			}


		} else {
			console.log(id);
			let response = await fetch(`/api/user/bookmark/${id}/save`);
			let body = await response.json();

			if (body.sucuess == false) {
				alert(body.data)
			}
			if (body.sucuess == true) {
				alert(body.data)
				currentValue = true;
				postingNum.innerHTML = bookmarked;
			}

		}


		postingNum.setAttribute('data-value', currentValue);

	}


	function searchAllPagePlus() {
		pageSearchAllFind = document.querySelector("#pageSearchAllFind")
		// console.log(pageSearchAllFind.value);
		pageSearchAllFind.value++;
		// console.log(pageSearchAllFind.value);

		let selectPageSearchAllForm = document.getElementById("selectPageSearchAllForm");
		selectPageSearchAllForm.submit();
	}

	function searchAllPageMinus() {
		pageSearchAllFind = document.querySelector("#pageSearchAllFind")
		// console.log(pageSearchAllFind.value);
		pageSearchAllFind.value--;
		// console.log(pageSearchAllFind.value);

		let selectPageSearchAllForm = document.getElementById("selectPageSearchAllForm");
		selectPageSearchAllForm.submit();
	}


</script>




{{> layout/footer}}